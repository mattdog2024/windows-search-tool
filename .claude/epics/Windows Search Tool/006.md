---
name: PyQt6 主窗口和索引管理界面
status: open
created: 2025-10-16T08:21:20Z
updated: 2025-10-16T08:21:20Z
github: Will be updated when synced to GitHub
depends_on: [004]
parallel: false
conflicts_with: []
---

# Task: PyQt6 主窗口和索引管理界面

## Description

实现 Windows Search Tool 的主窗口框架和索引管理界面,包括菜单栏、工具栏、索引列表展示、新建索引对话框和后台索引进度显示。这是用户界面的基础框架,为搜索功能提供入口和索引管理能力。

**核心目标:**
- 实现 MainWindow 主窗口框架(菜单栏、工具栏、状态栏)
- 实现 IndexPanel 索引列表展示(QTreeWidget)
- 实现 CreateIndexDialog 新建索引对话框
- 实现后台索引线程(QThread)和进度显示
- 实现索引操作(创建、删除、更新、暂停/恢复)

## Acceptance Criteria

- [ ] 主窗口框架实现
  - **MainWindow 类**
    - 继承 QMainWindow
    - 菜单栏(文件、编辑、索引、帮助)
    - 工具栏(新建索引、刷新、搜索、设置)
    - 状态栏(显示索引状态、文档数量、最后更新时间)
    - 中央区域分割为左右两栏(索引列表 + 搜索面板)
    - 窗口尺寸: 1280x800(默认)
    - 窗口图标和应用图标

- [ ] 索引列表面板实现
  - **IndexPanel (QWidget)**
    - QTreeWidget 展示索引列表
    - 列: 索引名称、路径、文档数量、大小、状态
    - 右键菜单(打开、刷新、删除、属性)
    - 双击打开索引详情
    - 状态图标(正在索引、已完成、错误)
    - 支持多选和批量操作

- [ ] 新建索引对话框实现
  - **CreateIndexDialog (QDialog)**
    - 索引名称输入框
    - 根目录选择(QFileDialog 选择文件夹)
    - 包含文件类型选择(多选 CheckBox)
    - 排除路径列表(QListWidget + 添加/删除按钮)
    - 高级选项(并行线程数、批次大小)
    - 实时验证(路径存在性、名称重复检查)
    - 创建按钮和取消按钮

- [ ] 索引进度显示实现
  - **IndexProgressWidget (QWidget)**
    - 总体进度条(QProgressBar)
    - 当前文件路径显示(QLabel,省略中间部分)
    - 统计信息(已处理/总数、速度、剩余时间)
    - 暂停/恢复按钮
    - 停止按钮(带确认对话框)
    - 实时更新(每秒刷新)

- [ ] 后台索引线程实现
  - **IndexWorker (QThread)**
    - 后台执行索引任务
    - 发送进度信号(progress, file_processed, error)
    - 支持暂停/恢复/停止
    - 异常捕获和错误处理
    - 完成后发送统计信息

- [ ] 菜单和工具栏实现
  - **菜单栏**
    - 文件: 新建索引、关闭索引、退出
    - 编辑: 设置、清除历史
    - 索引: 刷新索引、暂停/恢复、重建索引
    - 帮助: 关于、检查更新

  - **工具栏**
    - 新建索引按钮(图标 + 文字)
    - 刷新按钮
    - 搜索模式切换
    - 设置按钮

- [ ] 索引管理功能实现
  - 创建新索引(调用 IndexService)
  - 删除索引(带确认对话框)
  - 刷新索引(增量更新)
  - 查看索引统计信息
  - 导出索引数据

## Technical Details

### MainWindow 主窗口

```python
# src/ui/main_window.py
from PyQt6.QtWidgets import (
    QMainWindow, QWidget, QVBoxLayout, QHBoxLayout,
    QSplitter, QStatusBar, QMenuBar, QToolBar,
    QMenu, QMessageBox
)
from PyQt6.QtCore import Qt, QSize
from PyQt6.QtGui import QAction, QIcon
import logging

from .index_panel import IndexPanel
from .search_panel import SearchPanel
from ..utils.config import ConfigManager

logger = logging.getLogger(__name__)

class MainWindow(QMainWindow):
    """主窗口"""

    def __init__(self):
        super().__init__()
        self.config = ConfigManager()
        self.init_ui()

    def init_ui(self):
        """初始化用户界面"""
        self.setWindowTitle("Windows Search Tool")
        self.setGeometry(100, 100, 1280, 800)

        # 设置图标
        # self.setWindowIcon(QIcon("resources/icons/app.png"))

        # 创建菜单栏
        self._create_menu_bar()

        # 创建工具栏
        self._create_toolbar()

        # 创建中央部件
        self._create_central_widget()

        # 创建状态栏
        self._create_status_bar()

        # 应用主题
        self._apply_theme()

    def _create_menu_bar(self):
        """创建菜单栏"""
        menubar = self.menuBar()

        # 文件菜单
        file_menu = menubar.addMenu("文件(&F)")

        new_index_action = QAction("新建索引(&N)", self)
        new_index_action.setShortcut("Ctrl+N")
        new_index_action.triggered.connect(self.on_new_index)
        file_menu.addAction(new_index_action)

        file_menu.addSeparator()

        exit_action = QAction("退出(&X)", self)
        exit_action.setShortcut("Ctrl+Q")
        exit_action.triggered.connect(self.close)
        file_menu.addAction(exit_action)

        # 编辑菜单
        edit_menu = menubar.addMenu("编辑(&E)")

        settings_action = QAction("设置(&S)", self)
        settings_action.setShortcut("Ctrl+,")
        settings_action.triggered.connect(self.on_settings)
        edit_menu.addAction(settings_action)

        # 索引菜单
        index_menu = menubar.addMenu("索引(&I)")

        refresh_action = QAction("刷新索引(&R)", self)
        refresh_action.setShortcut("F5")
        refresh_action.triggered.connect(self.on_refresh_index)
        index_menu.addAction(refresh_action)

        rebuild_action = QAction("重建索引(&B)", self)
        rebuild_action.triggered.connect(self.on_rebuild_index)
        index_menu.addAction(rebuild_action)

        # 帮助菜单
        help_menu = menubar.addMenu("帮助(&H)")

        about_action = QAction("关于(&A)", self)
        about_action.triggered.connect(self.on_about)
        help_menu.addAction(about_action)

    def _create_toolbar(self):
        """创建工具栏"""
        toolbar = QToolBar("主工具栏")
        toolbar.setIconSize(QSize(24, 24))
        toolbar.setMovable(False)
        self.addToolBar(toolbar)

        # 新建索引按钮
        new_index_action = QAction("新建索引", self)
        # new_index_action.setIcon(QIcon("resources/icons/new.png"))
        new_index_action.triggered.connect(self.on_new_index)
        toolbar.addAction(new_index_action)

        # 刷新按钮
        refresh_action = QAction("刷新", self)
        # refresh_action.setIcon(QIcon("resources/icons/refresh.png"))
        refresh_action.triggered.connect(self.on_refresh_index)
        toolbar.addAction(refresh_action)

        toolbar.addSeparator()

        # 设置按钮
        settings_action = QAction("设置", self)
        # settings_action.setIcon(QIcon("resources/icons/settings.png"))
        settings_action.triggered.connect(self.on_settings)
        toolbar.addAction(settings_action)

    def _create_central_widget(self):
        """创建中央部件"""
        central_widget = QWidget()
        self.setCentralWidget(central_widget)

        layout = QHBoxLayout(central_widget)
        layout.setContentsMargins(5, 5, 5, 5)

        # 创建分割器
        splitter = QSplitter(Qt.Orientation.Horizontal)

        # 左侧: 索引列表
        self.index_panel = IndexPanel()
        self.index_panel.index_selected.connect(self.on_index_selected)
        splitter.addWidget(self.index_panel)

        # 右侧: 搜索面板
        self.search_panel = SearchPanel()
        splitter.addWidget(self.search_panel)

        # 设置分割比例 (30% : 70%)
        splitter.setSizes([300, 980])

        layout.addWidget(splitter)

    def _create_status_bar(self):
        """创建状态栏"""
        self.statusBar = QStatusBar()
        self.setStatusBar(self.statusBar)
        self.statusBar.showMessage("就绪")

    def _apply_theme(self):
        """应用主题"""
        theme = self.config.get("app.theme", "light")
        if theme == "dark":
            # 应用暗色主题样式
            pass

    # 槽函数
    def on_new_index(self):
        """新建索引"""
        from .create_index_dialog import CreateIndexDialog
        dialog = CreateIndexDialog(self)
        if dialog.exec() == 1:  # QDialog.Accepted
            # 获取配置并创建索引
            index_config = dialog.get_config()
            self.index_panel.create_index(index_config)

    def on_refresh_index(self):
        """刷新索引"""
        self.index_panel.refresh_selected_index()

    def on_rebuild_index(self):
        """重建索引"""
        reply = QMessageBox.question(
            self,
            "确认重建",
            "重建索引将删除现有数据并重新索引,是否继续?",
            QMessageBox.StandardButton.Yes | QMessageBox.StandardButton.No
        )
        if reply == QMessageBox.StandardButton.Yes:
            self.index_panel.rebuild_selected_index()

    def on_settings(self):
        """打开设置"""
        from .settings_dialog import SettingsDialog
        dialog = SettingsDialog(self)
        dialog.exec()

    def on_about(self):
        """关于对话框"""
        QMessageBox.about(
            self,
            "关于 Windows Search Tool",
            "<h3>Windows Search Tool 1.0</h3>"
            "<p>一个强大的本地文档全文搜索工具</p>"
            "<p>支持 Office、PDF、文本文件等多种格式</p>"
        )

    def on_index_selected(self, index_id: int):
        """索引选中事件"""
        self.search_panel.set_index(index_id)
        self.statusBar.showMessage(f"已选择索引: {index_id}")

    def closeEvent(self, event):
        """窗口关闭事件"""
        reply = QMessageBox.question(
            self,
            "确认退出",
            "是否退出 Windows Search Tool?",
            QMessageBox.StandardButton.Yes | QMessageBox.StandardButton.No
        )
        if reply == QMessageBox.StandardButton.Yes:
            event.accept()
        else:
            event.ignore()
```

### IndexPanel 索引列表

```python
# src/ui/index_panel.py
from PyQt6.QtWidgets import (
    QWidget, QVBoxLayout, QHBoxLayout, QPushButton,
    QTreeWidget, QTreeWidgetItem, QMenu, QMessageBox
)
from PyQt6.QtCore import Qt, pyqtSignal
from PyQt6.QtGui import QAction
import logging

from ..core.index_service import IndexService
from .index_progress_widget import IndexProgressWidget

logger = logging.getLogger(__name__)

class IndexPanel(QWidget):
    """索引列表面板"""

    index_selected = pyqtSignal(int)  # 索引选中信号

    def __init__(self):
        super().__init__()
        self.index_service = IndexService()
        self.init_ui()
        self.load_indexes()

    def init_ui(self):
        """初始化用户界面"""
        layout = QVBoxLayout(self)
        layout.setContentsMargins(0, 0, 0, 0)

        # 标题
        title_layout = QHBoxLayout()
        title_label = QPushButton("索引列表")
        title_label.setEnabled(False)
        title_layout.addWidget(title_label)
        title_layout.addStretch()
        layout.addLayout(title_layout)

        # 索引树
        self.tree = QTreeWidget()
        self.tree.setHeaderLabels(["名称", "路径", "文档数", "大小", "状态"])
        self.tree.setColumnWidth(0, 150)
        self.tree.setColumnWidth(1, 250)
        self.tree.setColumnWidth(2, 80)
        self.tree.setColumnWidth(3, 80)
        self.tree.setColumnWidth(4, 80)
        self.tree.setContextMenuPolicy(Qt.ContextMenuPolicy.CustomContextMenu)
        self.tree.customContextMenuRequested.connect(self.show_context_menu)
        self.tree.itemClicked.connect(self.on_item_clicked)
        layout.addWidget(self.tree)

        # 进度显示
        self.progress_widget = IndexProgressWidget()
        self.progress_widget.setVisible(False)
        layout.addWidget(self.progress_widget)

    def load_indexes(self):
        """加载索引列表"""
        self.tree.clear()
        indexes = self.index_service.list_indexes()

        for index in indexes:
            item = QTreeWidgetItem([
                index['name'],
                index['root_path'],
                str(index['document_count']),
                self._format_size(index['total_size']),
                index['status']
            ])
            item.setData(0, Qt.ItemDataRole.UserRole, index['id'])
            self.tree.addTopLevelItem(item)

    def create_index(self, config: dict):
        """创建新索引"""
        try:
            # 显示进度条
            self.progress_widget.setVisible(True)

            # 启动索引任务
            from .index_worker import IndexWorker
            self.worker = IndexWorker(config)
            self.worker.progress.connect(self.progress_widget.update_progress)
            self.worker.finished.connect(self.on_index_finished)
            self.worker.error.connect(self.on_index_error)
            self.worker.start()

        except Exception as e:
            logger.error(f"Failed to create index: {e}")
            QMessageBox.critical(self, "错误", f"创建索引失败: {e}")

    def refresh_selected_index(self):
        """刷新选中的索引"""
        current_item = self.tree.currentItem()
        if current_item:
            index_id = current_item.data(0, Qt.ItemDataRole.UserRole)
            self.index_service.refresh_index(index_id)
            self.load_indexes()

    def rebuild_selected_index(self):
        """重建选中的索引"""
        current_item = self.tree.currentItem()
        if current_item:
            index_id = current_item.data(0, Qt.ItemDataRole.UserRole)
            self.index_service.rebuild_index(index_id)
            self.load_indexes()

    def show_context_menu(self, position):
        """显示右键菜单"""
        item = self.tree.itemAt(position)
        if not item:
            return

        menu = QMenu()

        refresh_action = QAction("刷新", self)
        refresh_action.triggered.connect(self.refresh_selected_index)
        menu.addAction(refresh_action)

        delete_action = QAction("删除", self)
        delete_action.triggered.connect(self.delete_selected_index)
        menu.addAction(delete_action)

        menu.addSeparator()

        properties_action = QAction("属性", self)
        properties_action.triggered.connect(self.show_properties)
        menu.addAction(properties_action)

        menu.exec(self.tree.viewport().mapToGlobal(position))

    def delete_selected_index(self):
        """删除选中的索引"""
        current_item = self.tree.currentItem()
        if current_item:
            reply = QMessageBox.question(
                self,
                "确认删除",
                "确定要删除该索引吗?此操作不可恢复。",
                QMessageBox.StandardButton.Yes | QMessageBox.StandardButton.No
            )
            if reply == QMessageBox.StandardButton.Yes:
                index_id = current_item.data(0, Qt.ItemDataRole.UserRole)
                self.index_service.delete_index(index_id)
                self.load_indexes()

    def show_properties(self):
        """显示索引属性"""
        current_item = self.tree.currentItem()
        if current_item:
            index_id = current_item.data(0, Qt.ItemDataRole.UserRole)
            stats = self.index_service.get_index_statistics(index_id)

            message = f"""
索引名称: {stats['name']}
根路径: {stats['root_path']}
文档数量: {stats['document_count']}
总大小: {self._format_size(stats['total_size'])}
创建时间: {stats['created_at']}
最后更新: {stats['last_update']}
            """
            QMessageBox.information(self, "索引属性", message)

    def on_item_clicked(self, item, column):
        """项点击事件"""
        index_id = item.data(0, Qt.ItemDataRole.UserRole)
        self.index_selected.emit(index_id)

    def on_index_finished(self, stats: dict):
        """索引完成事件"""
        self.progress_widget.setVisible(False)
        self.load_indexes()
        QMessageBox.information(
            self,
            "索引完成",
            f"索引创建完成!\n\n"
            f"文档数量: {stats['document_count']}\n"
            f"总大小: {self._format_size(stats['total_size'])}\n"
            f"耗时: {stats['elapsed_time']:.2f} 秒"
        )

    def on_index_error(self, error: str):
        """索引错误事件"""
        self.progress_widget.setVisible(False)
        QMessageBox.critical(self, "错误", f"索引过程中发生错误:\n{error}")

    @staticmethod
    def _format_size(size: int) -> str:
        """格式化文件大小"""
        for unit in ['B', 'KB', 'MB', 'GB', 'TB']:
            if size < 1024:
                return f"{size:.2f} {unit}"
            size /= 1024
        return f"{size:.2f} PB"
```

### CreateIndexDialog 新建索引对话框

```python
# src/ui/create_index_dialog.py
from PyQt6.QtWidgets import (
    QDialog, QVBoxLayout, QHBoxLayout, QFormLayout,
    QLineEdit, QPushButton, QFileDialog, QCheckBox,
    QListWidget, QGroupBox, QSpinBox, QMessageBox
)
from PyQt6.QtCore import Qt
import os

class CreateIndexDialog(QDialog):
    """新建索引对话框"""

    def __init__(self, parent=None):
        super().__init__(parent)
        self.init_ui()

    def init_ui(self):
        """初始化用户界面"""
        self.setWindowTitle("新建索引")
        self.setMinimumWidth(600)

        layout = QVBoxLayout(self)

        # 基本信息
        form_layout = QFormLayout()

        # 索引名称
        self.name_input = QLineEdit()
        form_layout.addRow("索引名称:", self.name_input)

        # 根目录选择
        path_layout = QHBoxLayout()
        self.path_input = QLineEdit()
        self.browse_button = QPushButton("浏览")
        self.browse_button.clicked.connect(self.browse_directory)
        path_layout.addWidget(self.path_input)
        path_layout.addWidget(self.browse_button)
        form_layout.addRow("根目录:", path_layout)

        layout.addLayout(form_layout)

        # 文件类型选择
        file_types_group = QGroupBox("包含文件类型")
        file_types_layout = QVBoxLayout()

        self.docx_checkbox = QCheckBox("Word 文档 (.docx)")
        self.docx_checkbox.setChecked(True)
        self.xlsx_checkbox = QCheckBox("Excel 表格 (.xlsx)")
        self.xlsx_checkbox.setChecked(True)
        self.pptx_checkbox = QCheckBox("PowerPoint (.pptx)")
        self.pptx_checkbox.setChecked(True)
        self.pdf_checkbox = QCheckBox("PDF 文档 (.pdf)")
        self.pdf_checkbox.setChecked(True)
        self.txt_checkbox = QCheckBox("文本文件 (.txt, .md)")
        self.txt_checkbox.setChecked(True)

        file_types_layout.addWidget(self.docx_checkbox)
        file_types_layout.addWidget(self.xlsx_checkbox)
        file_types_layout.addWidget(self.pptx_checkbox)
        file_types_layout.addWidget(self.pdf_checkbox)
        file_types_layout.addWidget(self.txt_checkbox)

        file_types_group.setLayout(file_types_layout)
        layout.addWidget(file_types_group)

        # 排除路径
        exclude_group = QGroupBox("排除路径")
        exclude_layout = QVBoxLayout()

        self.exclude_list = QListWidget()
        exclude_layout.addWidget(self.exclude_list)

        exclude_buttons_layout = QHBoxLayout()
        self.add_exclude_button = QPushButton("添加")
        self.add_exclude_button.clicked.connect(self.add_exclude_path)
        self.remove_exclude_button = QPushButton("移除")
        self.remove_exclude_button.clicked.connect(self.remove_exclude_path)
        exclude_buttons_layout.addWidget(self.add_exclude_button)
        exclude_buttons_layout.addWidget(self.remove_exclude_button)
        exclude_buttons_layout.addStretch()
        exclude_layout.addLayout(exclude_buttons_layout)

        exclude_group.setLayout(exclude_layout)
        layout.addWidget(exclude_group)

        # 高级选项
        advanced_group = QGroupBox("高级选项")
        advanced_layout = QFormLayout()

        self.workers_spinbox = QSpinBox()
        self.workers_spinbox.setMinimum(1)
        self.workers_spinbox.setMaximum(16)
        self.workers_spinbox.setValue(4)
        advanced_layout.addRow("并行线程数:", self.workers_spinbox)

        self.batch_spinbox = QSpinBox()
        self.batch_spinbox.setMinimum(10)
        self.batch_spinbox.setMaximum(1000)
        self.batch_spinbox.setValue(100)
        advanced_layout.addRow("批次大小:", self.batch_spinbox)

        advanced_group.setLayout(advanced_layout)
        layout.addWidget(advanced_group)

        # 按钮
        buttons_layout = QHBoxLayout()
        buttons_layout.addStretch()
        self.create_button = QPushButton("创建")
        self.create_button.clicked.connect(self.on_create)
        self.cancel_button = QPushButton("取消")
        self.cancel_button.clicked.connect(self.reject)
        buttons_layout.addWidget(self.create_button)
        buttons_layout.addWidget(self.cancel_button)
        layout.addLayout(buttons_layout)

    def browse_directory(self):
        """浏览目录"""
        directory = QFileDialog.getExistingDirectory(self, "选择根目录")
        if directory:
            self.path_input.setText(directory)

    def add_exclude_path(self):
        """添加排除路径"""
        directory = QFileDialog.getExistingDirectory(self, "选择排除路径")
        if directory:
            self.exclude_list.addItem(directory)

    def remove_exclude_path(self):
        """移除排除路径"""
        current_item = self.exclude_list.currentItem()
        if current_item:
            self.exclude_list.takeItem(self.exclude_list.row(current_item))

    def on_create(self):
        """创建索引"""
        # 验证输入
        if not self.name_input.text().strip():
            QMessageBox.warning(self, "警告", "请输入索引名称")
            return

        if not self.path_input.text().strip():
            QMessageBox.warning(self, "警告", "请选择根目录")
            return

        if not os.path.isdir(self.path_input.text()):
            QMessageBox.warning(self, "警告", "根目录不存在")
            return

        # 检查是否至少选择一种文件类型
        if not any([
            self.docx_checkbox.isChecked(),
            self.xlsx_checkbox.isChecked(),
            self.pptx_checkbox.isChecked(),
            self.pdf_checkbox.isChecked(),
            self.txt_checkbox.isChecked()
        ]):
            QMessageBox.warning(self, "警告", "请至少选择一种文件类型")
            return

        self.accept()

    def get_config(self) -> dict:
        """获取配置"""
        file_types = []
        if self.docx_checkbox.isChecked():
            file_types.extend(['.docx'])
        if self.xlsx_checkbox.isChecked():
            file_types.extend(['.xlsx', '.xls'])
        if self.pptx_checkbox.isChecked():
            file_types.extend(['.pptx'])
        if self.pdf_checkbox.isChecked():
            file_types.append('.pdf')
        if self.txt_checkbox.isChecked():
            file_types.extend(['.txt', '.md', '.csv'])

        exclude_paths = []
        for i in range(self.exclude_list.count()):
            exclude_paths.append(self.exclude_list.item(i).text())

        return {
            'name': self.name_input.text().strip(),
            'root_path': self.path_input.text().strip(),
            'file_types': file_types,
            'exclude_paths': exclude_paths,
            'parallel_workers': self.workers_spinbox.value(),
            'batch_size': self.batch_spinbox.value()
        }
```

### IndexWorker 后台索引线程

```python
# src/ui/index_worker.py
from PyQt6.QtCore import QThread, pyqtSignal
import logging
import time

from ..core.index_service import IndexService

logger = logging.getLogger(__name__)

class IndexWorker(QThread):
    """索引工作线程"""

    progress = pyqtSignal(int, int, str)  # (current, total, current_file)
    finished = pyqtSignal(dict)  # 统计信息
    error = pyqtSignal(str)  # 错误消息

    def __init__(self, config: dict):
        super().__init__()
        self.config = config
        self.index_service = IndexService()
        self.is_running = True
        self.is_paused = False

    def run(self):
        """执行索引任务"""
        try:
            start_time = time.time()

            # 创建索引
            index_id = self.index_service.create_index(
                name=self.config['name'],
                root_path=self.config['root_path'],
                file_types=self.config['file_types'],
                exclude_paths=self.config['exclude_paths'],
                parallel_workers=self.config['parallel_workers'],
                batch_size=self.config['batch_size'],
                progress_callback=self.progress_callback
            )

            # 获取统计信息
            stats = self.index_service.get_index_statistics(index_id)
            stats['elapsed_time'] = time.time() - start_time

            self.finished.emit(stats)

        except Exception as e:
            logger.error(f"Index worker error: {e}")
            self.error.emit(str(e))

    def progress_callback(self, current: int, total: int, current_file: str):
        """进度回调"""
        if self.is_running:
            while self.is_paused:
                time.sleep(0.1)
            self.progress.emit(current, total, current_file)

    def pause(self):
        """暂停"""
        self.is_paused = True

    def resume(self):
        """恢复"""
        self.is_paused = False

    def stop(self):
        """停止"""
        self.is_running = False
        self.is_paused = False
```

### IndexProgressWidget 进度显示

```python
# src/ui/index_progress_widget.py
from PyQt6.QtWidgets import (
    QWidget, QVBoxLayout, QHBoxLayout, QLabel,
    QProgressBar, QPushButton
)
from PyQt6.QtCore import Qt

class IndexProgressWidget(QWidget):
    """索引进度显示"""

    def __init__(self):
        super().__init__()
        self.init_ui()

    def init_ui(self):
        """初始化用户界面"""
        layout = QVBoxLayout(self)

        # 当前文件
        self.file_label = QLabel("正在处理: ")
        layout.addWidget(self.file_label)

        # 进度条
        self.progress_bar = QProgressBar()
        self.progress_bar.setMinimum(0)
        self.progress_bar.setMaximum(100)
        layout.addWidget(self.progress_bar)

        # 统计信息
        self.stats_label = QLabel("已处理: 0 / 0 (0%)")
        layout.addWidget(self.stats_label)

        # 按钮
        buttons_layout = QHBoxLayout()
        self.pause_button = QPushButton("暂停")
        self.stop_button = QPushButton("停止")
        buttons_layout.addWidget(self.pause_button)
        buttons_layout.addWidget(self.stop_button)
        buttons_layout.addStretch()
        layout.addLayout(buttons_layout)

    def update_progress(self, current: int, total: int, current_file: str):
        """更新进度"""
        if total > 0:
            percentage = int((current / total) * 100)
            self.progress_bar.setValue(percentage)
            self.stats_label.setText(f"已处理: {current} / {total} ({percentage}%)")

        # 省略中间路径
        if len(current_file) > 50:
            current_file = current_file[:20] + "..." + current_file[-27:]
        self.file_label.setText(f"正在处理: {current_file}")
```

## Dependencies

**外部依赖:**
- PyQt6 6.5+
- PyQt6-Qt6 6.5+

**内部依赖:**
- Task 004: 索引服务和文件监视器实现
- Task 001: 项目基础架构(配置管理、日志系统)

## Effort Estimate

- **Size:** L (Large)
- **Hours:** 16-20 小时
- **Parallel:** false (依赖 Task 004)

**时间分配:**
- MainWindow 框架: 3 小时
- IndexPanel 实现: 4 小时
- CreateIndexDialog 实现: 3 小时
- IndexWorker 线程: 3 小时
- IndexProgressWidget: 2 小时
- 测试和调试: 3 小时
- UI 优化和文档: 2 小时

## Definition of Done

- [x] 代码实现完成
  - MainWindow 主窗口框架
  - IndexPanel 索引列表展示
  - CreateIndexDialog 对话框
  - IndexWorker 后台线程
  - IndexProgressWidget 进度显示

- [x] 功能测试完成
  - 主窗口正常显示
  - 索引列表正确加载
  - 新建索引对话框可用
  - 后台索引正常工作
  - 进度显示准确

- [x] UI/UX 测试完成
  - 界面布局合理
  - 响应流畅(无卡顿)
  - 错误提示友好
  - 操作符合直觉

- [x] 代码质量
  - 通过 black 格式化
  - 通过 pylint 检查(评分 ≥ 8.0)
  - 类型注解完整
  - 信号和槽连接正确

- [x] 验收测试
  - 能创建和管理索引
  - 后台索引不阻塞界面
  - 进度实时更新
  - 索引统计信息准确
